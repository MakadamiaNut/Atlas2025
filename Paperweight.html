<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Magnifying Lens Effect</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #000;
        }

        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
            cursor: none;
        }

        #canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #instruction {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 14px;
            text-align: center;
            pointer-events: none;
            opacity: 1;
            transition: opacity 0.5s;
        }

        #instruction.hidden {
            opacity: 0;
        }

        .lens-cursor {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle at 30% 30%, 
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0.1) 30%,
                rgba(255, 255, 255, 0.05) 60%,
                transparent 100%);
            box-shadow: 
                0 0 30px rgba(255, 255, 255, 0.3),
                inset 0 0 30px rgba(255, 255, 255, 0.2),
                0 0 50px rgba(100, 150, 255, 0.2);
            border: 2px solid rgba(236, 255, 246, 0.4);
            z-index: 10;
        }

        .locked {
            box-shadow: 
                0 0 40px rgba(144, 172, 121, 0.5),
                inset 0 0 30px rgba(255, 255, 255, 0.3),
                0 0 60px rgba(144, 172, 121, 0.3);
            border: 2px solid rgba(144, 172, 121, 0.6);
        }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="canvas"></canvas>
        <div id="lensCursor" class="lens-cursor"></div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const lensCursor = document.getElementById('lensCursor');
        const instruction = document.getElementById('instruction');

        let img = new Image();
        let isLoaded = false;
        let mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        let lensPos = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
        let isLocked = false;

        const lensRadius = 100;
        const distortionStrength = 0.5; 
        const easingFactor = 0.15;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (isLoaded) drawScene();
        }

        img.onload = function() {
            isLoaded = true;
            resizeCanvas();
            animate();
        };

        img.src = 'final.png';

        function drawScene() {
            if (!isLoaded) return;

            const scale = Math.max(canvas.width / img.width, canvas.height / img.height);
            const x = (canvas.width - img.width * scale) / 2;
            const y = (canvas.height - img.height * scale) / 2;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(img, x, y, img.width * scale, img.height * scale);

            applyLensEffect(lensPos.x, lensPos.y);
        }

        function applyLensEffect(centerX, centerY) {
            const diameter = lensRadius * 2;
            const imageData = ctx.getImageData(
                centerX - lensRadius,
                centerY - lensRadius,
                diameter,
                diameter
            );
            
            const pixels = imageData.data;
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = diameter;
            tempCanvas.height = diameter;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.putImageData(imageData, 0, 0);
            
            const originalData = tempCtx.getImageData(0, 0, diameter, diameter);
            
            for (let y = 0; y < diameter; y++) {
                for (let x = 0; x < diameter; x++) {
                    const dx = x - lensRadius;
                    const dy = y - lensRadius;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < lensRadius) {

                        const normalizedDist = distance / lensRadius;
                        const distortion = Math.pow(normalizedDist, 2) * distortionStrength;
                        const factor = 1 - distortion;
                        
                        const srcX = Math.round(lensRadius + dx * factor);
                        const srcY = Math.round(lensRadius + dy * factor);
                        
                        if (srcX >= 0 && srcX < diameter && srcY >= 0 && srcY < diameter) {
                            const destIndex = (y * diameter + x) * 4;
                            const srcIndex = (srcY * diameter + srcX) * 4;
                            
                            pixels[destIndex] = originalData.data[srcIndex];
                            pixels[destIndex + 1] = originalData.data[srcIndex + 1];
                            pixels[destIndex + 2] = originalData.data[srcIndex + 2];
                            pixels[destIndex + 3] = originalData.data[srcIndex + 3];
                        }
                    }
                }
            }
            
            ctx.putImageData(imageData, centerX - lensRadius, centerY - lensRadius);
        }

        function animate() {
            if (!isLocked) {
                lensPos.x += (mouse.x - lensPos.x) * easingFactor;
                lensPos.y += (mouse.y - lensPos.y) * easingFactor;
            }
            
            lensCursor.style.left = lensPos.x + 'px';
            lensCursor.style.top = lensPos.y + 'px';
            
            drawScene();
            requestAnimationFrame(animate);
        }

        document.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
            
           
        });

        document.addEventListener('click', () => {
            isLocked = !isLocked;
            
            if (isLocked) {
                lensCursor.classList.add('locked');
            } else {
                lensCursor.classList.remove('locked');
            }
        });

        window.addEventListener('resize', resizeCanvas);

        resizeCanvas();
    </script>
</body>
</html>